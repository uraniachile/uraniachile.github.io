<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>EchoPattern – Juego de Percepción y Memoria</title>
  <link rel="icon" type="image/png" href="SensoryVerse.png" />
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
    }
    .color-button {
      width: 80px;
      height: 80px;
      margin: 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      outline: none;
      transition: transform 0.1s;
    }
    .color-button:active {
      transform: scale(0.95);
    }
    #controls {
      margin: 2rem 0;
    }
    #message {
      margin-top: 1rem;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <h1>🔊 EcoPatrón 🔴🔵🟢</h1>
  <p>Memoriza la secuencia de colores y sonidos. La dificultad aumenta con el éxito y disminuye con los errores. ¡Juega tanto como quieras!</p>
  
  <div id="game">
    <div id="buttons">
      <button class="color-button" style="background:red" onclick="pressColor(0)"></button>
      <button class="color-button" style="background:blue" onclick="pressColor(1)"></button>
      <button class="color-button" style="background:green" onclick="pressColor(2)"></button>
    </div>
    
    <div id="controls">
      <button onclick="startGame()">Comenzar</button>
      <button onclick="finishGame()">Finalizar</button>
    </div>
    
    <div id="message"></div>
  </div>

  <script>
    const colors = ['red', 'blue', 'green'];
    const tones = [261.63, 329.63, 392.00]; // C, E, G
    let context = new (window.AudioContext || window.webkitAudioContext)();
    let sequence = [];
    let userInput = [];
    let level = 3;
    let score = 0;
    let visualFirstCount = 0, soundFirstCount = 0, simultaneousCount = 0;
    let mode;

    function playTone(index) {
      const o = context.createOscillator();
      const g = context.createGain();
      o.frequency.value = tones[index];
      o.type = 'sine';
      o.connect(g);
      g.connect(context.destination);
      o.start();
      o.stop(context.currentTime + 0.3);
    }

    function flashButton(index) {
      const btn = document.getElementsByClassName('color-button')[index];
      btn.style.opacity = '0.5';
      setTimeout(() => btn.style.opacity = '1', 300);
    }

    function delay(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    async function playSequence() {
      for (let i = 0; i < sequence.length; i++) {
        const index = sequence[i];
        mode = ['visual', 'audio', 'both'][Math.floor(Math.random() * 3)];

        if (mode === 'visual') {
          flashButton(index);
          visualFirstCount++;
          await delay(100);
          playTone(index);
        } else if (mode === 'audio') {
          playTone(index);
          soundFirstCount++;
          await delay(100);
          flashButton(index);
        } else {
          flashButton(index);
          playTone(index);
          simultaneousCount++;
        }
        await delay(500);
      }
    }

    function startGame() {
      userInput = [];
      sequence = Array.from({length: level}, () => Math.floor(Math.random() * 3));
      document.getElementById('message').textContent = `Nivel ${level} – Observa y escucha con atención...`;
      playSequence();
    }

    function pressColor(index) {
      userInput.push(index);
      playTone(index);
      flashButton(index);
      if (userInput.length === sequence.length) {
        checkResult();
      }
    }

    function checkResult() {
      const correct = sequence.every((val, i) => val === userInput[i]);
      if (correct) {
        level++;
        score++;
        document.getElementById('message').textContent = "✅ ¡Correcto! Siguiente nivel...";
      } else {
        level = Math.max(3, level - 1);
        document.getElementById('message').textContent = "❌ Incorrecto. Vamos a intentar con uno más fácil.";
      }
      setTimeout(startGame, 1500);
    }

    function finishGame() {
      let total = visualFirstCount + soundFirstCount + simultaneousCount;
      let visualPct = Math.round((visualFirstCount / total) * 100);
      let soundPct = Math.round((soundFirstCount / total) * 100);
      let simPct = 100 - visualPct - soundPct;

      document.getElementById('game').innerHTML = `
        <h2>Resumen del Juego</h2>
        <p>🧠 Secuencia más larga lograda: ${level}</p>
        <p>🎨 Respuesta visual: ${visualPct}%</p>
        <p>🎵 Respuesta auditiva: ${soundPct}%</p>
        <p>🔄 Simultáneo: ${simPct}%</p>
        <p>¡Puedes jugar de nuevo cuando quieras para mejorar o poner a prueba tu enfoque!</p>
        <button onclick="location.reload()">Jugar de nuevo</button>
      `;
    }
  </script>

  <footer>
 <center><a href="index.html" target="_blank"><img src="urania_logo.png" alt="Logo Urania" width="50"></a><center>
    Creado por Urania – © 2025 Todos los derechos reservados
  </footer>


</body>
</html>